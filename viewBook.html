<!DOCTYPE html>

<html>
    <head>

        <meta charset="utf-8" />
        <meta meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="css/general.css" type="text/css">
        <link rel="stylesheet" href="css/responsive.css" type="text/css">
        <link rel="stylesheet" href="css/dialogos.css" type="text/css">

        <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
        <script src="js/Api.js" type="module"  ></script>
        <script src="js/Book.js" type="module" ></script>
        <script src="js/Fetch.js" type="module" ></script>
        <script src="js/Icons.js" crossorigin="anonymous"></script>

        <!--<link rel="shortcut icon" href="./img/Loto_icon.png">-->

        <title>View Book</title>

    </head>
    <body>

        <section class="site-title-bar">

            <section class="container container-flex">

                <h1>Tecno Library</h1>

            </section>

        </section>

        <section class="book-content container" id="book-content">
            <section class="book-content-buttons">
                <img id="cover"/>
                <section>
                    <button id="btn_add";>Agregar a mi lista</button>
                    <button id="btn_download">Descarga</button>
                </section>
            </section>
            <section class="content">
                <h1 id="title"></h1>
                <h2 id="author"></h2>
                <section class="content-details">
                    <p>Año: </p>
                    <h3 id="year"></h3>
                    <p>Paginas: </p>
                    <h3 id="pages"></h3>
                    <p>Idioma: </p>
                    <h3 id="lang"></h3>
                </section>
                <h4>Contenido</h4>
                <section id="content"></section>
            </section>
            
        </section>

        
        <script type="module">
            import Api from './js/Api.js'
            import Fetch from './js/Fetch.js'
           

            //fetch('http://localhost/api-library/php/api.php?book_action=get_book').
            fetch('http://localhost:8080/api-library/php/api.php?book_action=get_book').
            then(res => res.json()).
                then(data => {
       
                    console.log(data);
                    extract_book(data);

                })


            //Extraer datos del libro
            function extract_book(json) {

                let api = new Api();
                api.getBook(json.id);
                //console.log(json.id);
                let url = api.getUrl();
                fetch(url).
                    then(res => res.json()).
                    then(data => extract_data(data[0])).
                    catch(error => console.log(error));

            }

            function extract_data(json) {
                //console.log(json);

                let title = document.getElementById('title');
                title.innerHTML = json.title;

                let author = document.getElementById('author');
                author.innerHTML = json.author;

                let year = document.getElementById('year');
                year.innerHTML = json.publisher_date;

                let pages = document.getElementById('pages');
                pages.innerHTML = json.pages;

                let lang = document.getElementById('lang');
                lang.innerHTML = json.language;

                let content = document.getElementById('content');
                content.innerHTML = json.content;

                let cover = document.getElementById('cover');
                cover.src = json.cover;

                let button = document.getElementById('btn_add');
                button.addEventListener("click", event => {

                    let params = new URLSearchParams({

                        session_action: "add_book",
                        book_ID: json.ID

                    }).toString();

                    //let url = 'http://localhost/api-library/php/api.php?' + params;
                    let url = 'http://localhost:8080/api-library/php/api.php?' + params;

                    fetch(url).
                        then(res => res.json()).
                        then(data => console.log(data)).
                        catch(error => console.log(error));

                })


            }

        </script>


    </body>

    
</html>